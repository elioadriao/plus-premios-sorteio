{% extends "layout/navigation.html" %}

{% load static %}

{% block title %}Detalhes do Sorteio{% endblock %}

{% block content %}

<!--? About Area Start -->
<div class="about-low-area padding-bottom">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 col-md-12">
        <div class="about-caption mb-50">
          <!-- Section Tittle -->
          <div class="section-tittle mb-35">
            <h2>Detalhes do Sorteio</h2>
            <h3>{{ raffle.date|date:"d/m/Y" }} às {{ raffle.date|date:"H:i" }}</h3>
            <h5>Valor Unitário da Cota {{ raffle.quota_value }}</h5>
          </div>
          <h4>{{ raffle.title }}</h4>
          <br>
          <h5 class="ml-2">{{ raffle.description }}</h5>
          {% if raffle.get_winner is not None %}
          <h5>Vencedor<br>{{ raffle.get_winner }}</h5>
          {% endif %}
          {% if raffle.is_date_valid %}
          <a href="#" class="btn radius" data-toggle="modal" data-target="#quotaBuyModal">Comprar Cotas</a>
          {% endif %}
        </div>
      </div>
      <div class="col-lg-6 col-md-12">
        <div class="about-img">
          <div class="img-fluid">
            {% if raffle.image %}
            <img style="max-height: 350px;" src="{{ raffle.image.url }}" alt="">
            {% else %}
            <img style="max-height: 350px;" src="{% static 'vendor/img/empty.jpg' %}" alt="">
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-lg-12 col-md-12 contact-form-area">
        <div class="contact-form-wrapper">
          {% for quota in quotas %}
          <a href="#" class="genric-btn {{ quota.get_btn }} small radius open-modal" data-toggle="modal"
           data-target="#quotaShowModal" data-number={{ quota.number }} data-status={{ quota.status }}
           {% if quota.owner %}data-owner={{ quota.owner }}{% endif %} {% if quota.reserved_at %}
           data-reservedat="{{ quota.reserved_at|date:"d/m/Y" }} às {{ quota.reserved_at|date:"H:i" }}"{% endif %}
           {% if quota.paid_at %}data-paidat="{{ quota.paid_at|date:"d/m/Y" }} às {{ quota.paid_at|date:"H:i" }}"{% endif %}>
            Cota: {{ quota.number }} | {{ quota.get_status }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<!-- About Area End -->
<div class="modal fade" id="quotaBuyModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title title-a">Valor Unitário da Cota {{ raffle.quota_value }}</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post">
          {% csrf_token %}
          {% for quota_input in form.quotas %}
          <div class="form-check form-check-inline">
            {{ quota_input }}
          </div>
          {% endfor %}
          <button class="btn radius btn-block mt-2" type="submit">Reservar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="quotaShowModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title title-a">Detalhes da Cota</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h4 id="quota_owner" class="ml-2"></h4>
        <h4 id="reserved_at" class="ml-2"></h4>
        <h4 id="paid_at" class="ml-2"></h4>
      </div>
    </div>
  </div>
</div>

{% endblock %}
{% block post_js %}
<script type="text/javascript">
  $(document).on("click", ".open-modal", function () {
    var quotaNumber = $(this).data("number");
    var quotaStatus = $(this).data("status");
    var quotaOwner = $(this).data("owner");
    var reservedAt = $(this).data("reservedat");
    var paidAt = $(this).data("paidat");
    $("#id_number").val( quotaNumber );

    if (quotaStatus != "open") {
      $("#quota_owner").text("Dono da Cota " + quotaOwner);
      $("#reserved_at").text("Reservado em " + reservedAt);
      if (paidAt){
        $("#paid_at").text("Pago em " + paidAt);
      } else {
        $("#paid_at").text("Pagamento em Analise");
      }
    } else {
      $("#quota_owner").text("");
      $("#reserved_at").text("");
      $("#paid_at").text("");
    }
  });
</script>
{% endblock %}